<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.InsightPrep.domain.question.mapper.RecentPromptFilterMapper">

    <!-- 최근 금지어/주제 저장 (중복이면 무시) -->
    <insert id="insert" parameterType="recent-prompt-filter">
        INSERT INTO recent_prompt_filters
            (member_id, category, item_type, item_value, created_at)
        VALUES
            (#{memberId}, #{category}, #{itemType}, #{itemValue}, NOW())
        ON CONFLICT (member_id, category, item_type, item_value) DO NOTHING
    </insert>

    <!-- 최근 N개 조회 (최신순) -->
    <select id="findTopNByUserCategoryType" resultType="string">
        SELECT item_value
        FROM recent_prompt_filters
        WHERE member_id = #{memberId}
          AND category  = #{category}
          AND item_type = #{type}
        ORDER BY created_at DESC
        LIMIT #{limit}
    </select>

</mapper>